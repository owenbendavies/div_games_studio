compiler_options _extended_conditions;
PROGRAM TENNIS;
GLOBAL

ANIM1[]=50,50,51,51,52,52,53,53,54,54,55,55,56,56,57,57,58,58,59,59;
ANIM1B[]=60,60,61,61,62,62,63,63,64,64,65,65,66,66,67,67,68,68,69,69;
ANIM2[]=70,70,71,71,72,72,73,73,74,74,75,75,76,76,77,77,78,78,79,79;
ANIM2b[]=80,80,81,81,82,82,83,83,84,84,85,85,86,86,87,87,88,88,89,89;
ANIM3[]=79,79,78,78,77,77,76,76,75,75,74,74,73,73,72,72,71,71,70,70;

ANIM4[]=90,90,91,91,92,92,93,93,94,94,95,95,96,96,97,97,98,98,99,99,100,100,101,101,102,102;
ANIM4b[]=109,109,110,110,111,111,112,112,113,113,114,114,115,115,116,116,117,117,118,118,119,119,120,120,121,121;


ANIM10[]=170,171,172,173,174,175,176,177,178,179,180;
ANIM11[]=180,181,182,183,184,185,186,187,188,189,190;

flip=false;

STAGE=1;
STAGEND=TRUE;

FPG1;FPG2;FPG3; FNT1;FNT2;FNT3; PCM1;PCM2;PCM3; CAM1;CAM2; CURSORX;CURSORY;

PLAYER1DIST;PLAYER2DIST;PLAYER2XDIST;PLAYER2YDIST;PLAY1;PLAY2;JUMP=0;
PLAY1HITTING=FALSE;PLAY1HIT=FALSE;
PLAY2HITTING=FALSE;PLAY2HIT=FALSE;
BALLVAL;BALLX;BALLY;BALLDIR=1;CREST;NEWBALL=1;BOUNCE=0;

KINGSIGNAL=0;

NETHIT=0; NVAL;
IX; IY;

OUTEXT;TXTID1;ID1;ID2;ID3;
SERVING;

MOVING;

ENERGY=0;
CFLAGS=0;

SWING=1;

G1=17; G2=18;

local
BSPEED;
AT=0;ATOUCH=0;
A_STEP;
NEWSCORE=1;
SCORE=0;SETS=0;
STATE;
//MTIME=0;
//SCORE;

BEGIN
SET_FPS(30,0);
LOOP
IF (STAGEND==TRUE)
SWITCH(STAGE)
//////////////////////////////////
case 1:
FADE_ON();
(STAGEND=FALSE); LET_ME_ALONE();
FPG1=LOAD_FPG("user\mTENNIS\COURT1.FPG");
FNT1=LOAD_FNT("user\mTENNIS\FNT32.FNT");
FNT2=LOAD_FNT("user\mTENNIS\FNT64.FNT");
SET_MODE(1024768);
DEFINE_REGION(1,0,0,1024,768);   // MAIN AREA
START_MODE7(1,0,1,6,1,167);    ////////////////////
DEFINE_REGION(2,0,0,1024,190);  //   &SKY BIT
start_scroll(1,0,25,12,2,5);   ////////////////////
scroll[1].z=1000;
M7[1].HEIGHT =1700;
M7[1].DISTANCE =738;
M7[1].COLOR =220;
M7[1].FOCUS =128;
//PLAY1=PLAYER1(50,240,888);
//PLAY2=PLAYER2(50,720,50);
//CAM1=CAMLOCK(483,1150);
CAM2=CAMSWING(X,Y);
//CAM2.STATE=2;
M7[1].CAMERA=CAM2;
NETS(30,482);
OBJECT(800,210,11,230,0,6,C_SCREEN,-100);
WRITE(FNT1,250,340,3,"SUPER");
WRITE(FNT2,512,384,4,"MONKEY TENNIS");
WRITE(0,1020,10,5,"Created by Paul Hamilton - MonkeyMookGames 25/03/2002");
STARTFLASH();

//PLANNER(100,100,11,6);
//CURSOR(100,100);
REPEAT
IF(RAND(0,300)==300)BIRD(1034,RAND(0,150));END
SCROLL[1].X0-=10;
//IF(NEWBALL==1) //SIGNAL(TYPE BALL,S_KILL_TREE);
//BALLVAL=BALL(720,60,-1,3,500);/*BALLDIR=1;BSPEED=40;*/NEWBALL=0; END

//IF(KEY(_ENTER))PLAY1.NEWSCORE=1;PLAY2.NEWSCORE=1;
// SIGNAL(TYPE SOBJECT,S_KILL);
//END

if(key(_ESC))STAGEND=TRUE;STOP_SOUND(ALL_SOUND);exit("HOO HA HA!",69);END
IF(KEY(_ENTER))STAGEND=TRUE;STOP_SOUND(ALL_SOUND);DELETE_TEXT(ALL_TEXT);STAGE=2;END
FRAME;
UNTIL(STAGEND==TRUE);

END//CASE1
//////////////////////////////////
case 2:
 FADE_ON();(STAGEND=FALSE);LET_ME_ALONE();set_mode(640480);
FNT1=LOAD_FNT("user\mtennis\FNT32.FNT");
FNT2=LOAD_FNT("user\mtennis\FNT64.FNT");
 WRITE(FNT2,320,20,4,"INSRUCTIONS");
 WRITE(FNT1,320,120,4,"USE THE ARROW KEYS TO MOVE");
 WRITE(FNT1,320,220,4,"HOLD CONTROL TO HIT THE BALL");
 WRITE(FNT1,320,270,4,"AND PRESS");
 WRITE(FNT1,320,320,4,"LEFT OR RIGHT TO DIRECT BALL");
 WRITE(FNT1,320,420,4,"PRESS SHIFT TO JUMP");
 WRITE(0,320,470,4,"Also you can press enter to reset the scores");

REPEAT
if(scan_code<>0)stagend=true;stage=3;end
FRAME;
UNTIL(STAGEND==TRUE);
end
///////////////////////////////////////////////////////////
CASE 3:  FRAME(2000);delete_text(all_text);
FADE_ON();
(STAGEND=FALSE); LET_ME_ALONE();
FPG1=LOAD_FPG("user\mtennis\COURT1.FPG");
FNT1=LOAD_FNT("user\mtennis\FNT32.FNT");
FNT2=LOAD_FNT("user\mtennis\FNT64.FNT");

SET_MODE(1024768);

DEFINE_REGION(1,0,0,1024,768);   // MAIN AREA
START_MODE7(1,0,1,6,1,167);    ////////////////////
DEFINE_REGION(2,0,0,1024,190);  //   &SKY BIT
start_scroll(1,0,25,12,2,5);   ////////////////////
scroll[1].z=1000;
M7[1].HEIGHT =1700;
M7[1].DISTANCE =100;
M7[1].COLOR =220;
M7[1].FOCUS =128;

PLAY1=PLAYER1(50,240,888);
PLAY2=PLAYER2(50,720,50);

CAM1=CAMLOCK(483,1150);
//CAM2=CAMSWING(X,Y);
M7[1].CAMERA=CAM1;
NETS(30,482);
//cursor(160,120);

HUD();
//BALLVAL=BALL(420,350,-1,3,500);
//WRITE_INT(0,150,450,4,&BALLVAL.AT);
REPEAT
IF(RAND(0,300)==300)BIRD(1034,RAND(0,150));END
IF(NEWBALL==1) //SIGNAL(TYPE BALL,S_KILL_TREE);
BALLVAL=BALL(720,60,-1,3,500);/*BALLDIR=1;BSPEED=40;*/NEWBALL=0; END
IF(KEY(_ENTER))PLAY1.NEWSCORE=1;PLAY2.NEWSCORE=1;
 SIGNAL(TYPE SOBJECT,S_KILL);
END
if(key(_esc))STAGEND=TRUE;STOP_SOUND(ALL_SOUND);END
FRAME;
UNTIL(STAGEND==TRUE);exit("HOO HA HA!",69);
end//CASE1



END//switch
END
FRAME;
END
END
//////////////////////////////////////////////////////////////
PROCESS HUD();
BEGIN CTYPE=C_SCREEN;
WRITE(FNT1,20,60,3,"TIM APEMAN - ");
WRITE(FNT1,20,120,3,"PLAYER ONE - ");
WRITE_INT(FNT2,280,50,3,&PLAY2.SCORE);
WRITE_INT(FNT2,280,110,3,&PLAY1.SCORE);
UMPIRE();KINGO(-300,530,150,340,0,0,C_m7,-101,1250);
NRGBAR();TXTID1=POWERFLASH();
OBJECT(194,84,26,100,0,4,C_SCREEN,0);
//GREYED OUT STARS
OBJECT(40,35,13,70,0,4,C_SCREEN,-100);OBJECT(80,35,13,70,0,4,C_SCREEN,-100);OBJECT(120,35,13,70,0,4,C_SCREEN,-100);
OBJECT(40,95,13,70,0,4,C_SCREEN,-100);OBJECT(80,95,13,70,0,4,C_SCREEN,-100);OBJECT(120,95,13,70,0,4,C_SCREEN,-100);
//ATMOSPHERE         //8700             //1650
tOBJECT(470,-1200,11,5000,0,6,C_m7,-100,1650);
//tOBJECT(470,1200,11,5000,0,6,C_m7,-100,1850);
//like signs/////////////////////////////////////////////////
SIGN(40,-150,32,1440,0,0,C_m7,-100,0);SIGN(840,-150,32,1440,0,0,C_m7,-100,0);
SIGN(-600,-150,32,1440,0,0,C_m7,-100,0);SIGN(1500,-150,32,1440,0,0,C_m7,-100,0);


//m7OBJECT(40,1050,18,1450,0,1,C_m7,-100,0);m7OBJECT(840,1050,18,1450,0,1,C_m7,-100,0);

//chairs
m7OBJECT(1230,530,19,300,0,0,C_m7,-100,0);m7OBJECT(1230,530,20,390,0,4,C_m7,100,-30);m7OBJECT(1250,530,21,300,0,0,C_m7,-102,990);
m7OBJECT(-300,530,19,300,0,1,C_m7,-100,0);m7OBJECT(-300,530,20,390,0,5,C_m7,100,-30);m7OBJECT(-320,530,21,300,0,1,C_m7,-102,990);
//big tree
m7OBJECT(470,-270,27,6000,0,0,C_m7,-100,0);
//trees
//tOBJECT(-750,-90,23,600,0,0,C_m7,-100,0);
tOBJECT(-550,-290,24,800,0,1,C_m7,-100,0);
//tOBJECT(-250,-300,23,600,0,0,C_m7,-100,0);
tOBJECT(1250,-300,23,800,0,0,C_m7,-100,0);
//tOBJECT(1380,130,23,700,0,1,C_m7,-100,0);
tOBJECT(-600,400,23,600,0,0,C_m7,-100,0);
tOBJECT(1200,600,24,800,0,0,C_m7,-100,0);

//tOBJECT(-550,0,23,200,0,0,C_m7,-100,0);
//tOBJECT(480,960,23,100,0,0,C_m7,-100,0);
//tOBJECT(-140,760,23,260,0,1,C_m7,-100,0);

//NET POSTS
SHOBJECT(-20,490,22,360,0,0,C_m7,-100,0);SHOBJECT(975,490,22,360,0,1,C_m7,-100,0);

//planner(100,530,17,0);
//write_int(0,100,100,4,&energy);
END
///////////////////////////////////////////////
PROCESS KINGO(X,Y,GRAPH,SIZE,ANGLE,FLAGS,CTYPE,Z,HEIGHT);
BEGIN  STATE=1; CFLAGS=0;
 LOOP
  //FLAGS=CFLAGS;
  if(flip==true)if(flags==1)flags=0;else if(flags==0)flags=1;end end end
  SWITCH(STATE)
   CASE 1:
    IF(BALLY<96)GRAPH=154;ELSE
    IF(BALLY>96 AND BALLY<192)GRAPH=153;ELSE
    IF(BALLY>192 AND BALLY<288)GRAPH=152;ELSE
    IF(BALLY>288 AND BALLY<384)GRAPH=151;ELSE
    IF(BALLY>384 AND BALLY<480)GRAPH=150;ELSE
    IF(BALLY>480 AND BALLY<576)GRAPH=160;ELSE
    IF(BALLY>576 AND BALLY<672)GRAPH=161;ELSE
    IF(BALLY>672 AND BALLY<768)GRAPH=162;ELSE
    IF(BALLY>768 AND BALLY<864)GRAPH=163;ELSE
    IF(BALLY>864 AND BALLY<960)GRAPH=164;ELSE
    END END END END END END END END END END
    IF(KINGSIGNAL==1)STATE=2;GRAPH=170;END
    IF(KINGSIGNAL==2)STATE=3;GRAPH=180;END
   END
   CASE 2:
    GRAPH=ANIM10[A_STEP++];IF(A_STEP==SIZEOF(ANIM10));a_step=0;END
   END
   CASE 3:
    GRAPH=ANIM11[A_STEP++];IF(A_STEP==SIZEOF(ANIM11));a_step=0;END
   END
  END
 IF(KINGSIGNAL==0)STATE=1;END
 FRAME;
 END
END
//////////////////////////////////////////////////////////////
PROCESS UMPIRE();
BEGIN //STATE=1;
 LOOP
  IF(PLAY1.SCORE==50)PLAY1.SETS++;PLAY1.NEWSCORE=1;PLAY2.NEWSCORE=1;
   IF(PLAY1.SETS==1)SOBJECT(40,95,14,70,0,0,C_SCREEN,-100);END
   IF(PLAY1.SETS==2)SOBJECT(80,95,14,70,0,0,C_SCREEN,-100);END
   IF(PLAY1.SETS==3)SOBJECT(120,95,14,70,0,0,C_SCREEN,-100);END
  END
  IF(PLAY2.SCORE==50)PLAY2.SETS++;PLAY1.NEWSCORE=1;PLAY2.NEWSCORE=1;
   IF(PLAY2.SETS==1)SOBJECT(40,35,14,70,0,0,C_SCREEN,-100);END
   IF(PLAY2.SETS==2)SOBJECT(80,35,14,70,0,0,C_SCREEN,-100);END
   IF(PLAY2.SETS==3)SOBJECT(120,35,14,70,0,0,C_SCREEN,-100);END
  END
 FRAME;
 END
END
///////////////////////////////////////////////
PROCESS NRGBAR();
PRIVATE WIDE=0; HIGH=20;
BEGIN
 CTYPE=C_SCREEN;REGION=3;
 ROBJECT(90,710,15,100,0,0,C_SCREEN,-100,3);ROBJECT(190,710,15,100,0,0,C_SCREEN,-100,3);ROBJECT(290,710,15,100,0,0,C_SCREEN,-100,3);
 OBJECT(90,710,16,100,0,4,C_SCREEN,-100);OBJECT(190,710,16,100,0,4,C_SCREEN,-100);OBJECT(290,710,16,100,0,4,C_SCREEN,-100);
 LOOP
  IF(ENERGY<1 AND wide>0)wide-=10;END
  IF(WIDE<0)WIDE=0;END
  IF(ENERGY>1 AND wide<100)wide+=3;END
  IF(ENERGY>3 AND wide<200)wide+=3;END
  IF(ENERGY=>6 AND wide<300)wide+=3;SIGNAL(TXTID1,S_WAKEUP);END
  define_region(3,40,700,wide,HIGH);
 FRAME;
 END
END
///////////////////////////////////////////////
PROCESS POWERFLASH();
PRIVATE IDTEXT;
BEGIN
LOOP
IDTEXT=WRITE(FNT1,350,705,3,"FULL POWER");
FRAME(500);
DELETE_TEXT(IDTEXT);
IF(ENERGY<1);SIGNAL(TXTID1,S_SLEEP);END
FRAME(500);
END
END
////////////////////////////////////////////
PROCESS STARTFLASH();
PRIVATE IDTEXT1;
BEGIN
LOOP
IDTEXT1=WRITE(FNT1,512,705,4,"PRESS ENTER TO START");
IF(KEY(_ENTER));DELETE_TEXT(IDTEXT1);end//SIGNAL(ID,S_KILL);END
FRAME(2000);
DELETE_TEXT(IDTEXT1);
FRAME(1000);
DELETE_TEXT(IDTEXT1);
END
END
////////////////////////////////////////////////////////////
PROCESS BIRD(X,Y);
BEGIN GRAPH=28;REGION=2;CTYPE=C_SCROLL;SIZE=80;
REPEAT GRAPH++;IF(GRAPH>31)GRAPH=28;END
X-=1;
FRAME;
UNTIL(X<-10)SIGNAL(ID,S_KILL);
END
//////////////////////////////////////////////////////////////
PROCESS NETS(X,Y);
PRIVATE NEWX;         //376
BEGIN CTYPE=C_M7;SIZE=400;GRAPH=9;
IF(STAGE==2)flags=4;ELSE FLAGS=0;END
  FROM X=30 TO 900 STEP 36;
  CLONE
   BREAK;
  END
  END
LOOP
FRAME;
END
END
/////////////////////////////////////////////////////////
PROCESS SIGN(X,Y,GRAPH,SIZE,ANGLE,FLAGS,CTYPE,Z,HEIGHT);
PRIVATE SIGNY=-20;
BEGIN STATE=3;TIMER[5]=300;
LOOP
  SWITCH(STATE)
  CASE 1:
   MAP_BLOCK_COPY(0,32,0,SIGNY,17,0,0,100,30);
   STATE=2;
  END
  CASE 2:
   SIGNY+=1;
   STATE=1;
   IF(SIGNY>0)STATE=3;TIMER[5]=0;END
  END
  CASE 3:
   SIGNY=0;IF(TIMER[5]=>1000)STATE=4;SIGNY=-30;END
  END
  CASE 4:
   MAP_BLOCK_COPY(0,32,0,SIGNY,18,0,0,100,30);
   STATE=5;
  END
  CASE 5:
   SIGNY+=1;
   STATE=4;
   IF(SIGNY>0)STATE=6;TIMER[5]=0;END
  END
  CASE 6:
   SIGNY=0;IF(TIMER[5]=>1000)STATE=1;SIGNY=-30;END
  END
 END
FRAME;
END END
/////////////////////////////////////////////////////////
PROCESS OBJECT(X,Y,GRAPH,SIZE,ANGLE,FLAGS,CTYPE,Z);BEGIN LOOP FRAME;END END
/////////////////////////////////////////////////////////
PROCESS m7OBJECT(X,Y,GRAPH,SIZE,ANGLE,FLAGS,CTYPE,Z,HEIGHT);BEGIN
LOOP /*FLAGS=CFLAGS;*/
if(flip==true)if(flags==1)flags=0;else if(flags==0)flags=1;end end end
FRAME;END END
/////////////////////////////////////////////////////////
PROCESS tOBJECT(X,Y,GRAPH,SIZE,ANGLE,FLAGS,CTYPE,Z,HEIGHT);BEGIN
//shadow(x,y,24,size/2);
LOOP FRAME;END END
//////////////////////////////////////////////////////////
PROCESS SHOBJECT(X,Y,GRAPH,SIZE,ANGLE,FLAGS,CTYPE,Z,HEIGHT);BEGIN
M7OBJECT(x,y,3,800,0,4,C_M7,100,-50);
LOOP FRAME;END END
/////////////////////////////////////////////////////////
PROCESS SOBJECT(X,Y,GRAPH,SIZE,ANGLE,FLAGS,CTYPE,Z);BEGIN LOOP FRAME;END END
/////////////////////////////////////
PROCESS ROBJECT(X,Y,GRAPH,SIZE,ANGLE,FLAGS,CTYPE,Z,REGION);BEGIN LOOP FRAME;END END
/////////////////////////////////////
process cursor(x,y);begin
WRITE_INT(FNT1,100,100,4,&X);WRITE_INT(FNT1,100,150,4,&Y);
file=FPG1;graph=4;z=-500;loop x=mouse.x;CURSORX=X;y=mouse.y;CURSORY=Y;frame;end end
/////////////////////////////////////
/////////////////////////////////////
PROCESS CAMLOCK(X,Y);
BEGIN ctype=c_m7;m7[1].HEIGHT=1650;ANGLE=90000;SIZE=100;
 LOOP
 // Y=(((play2.Y+play1.Y)+4800)+NVAL)/5;
  x=((play2.x+play1.x)+1400)/5;
  FRAME;
 END
END
/////////////////////////////////////
PROCESS CAMSWING(X,Y);
PRIVATE CANGLE;
BEGIN CTYPE=C_M7;
//WRITE_INT(FNT1,100,500,3,&M7[1].DISTANCE);
//WRITE_INT(FNT1,100,550,3,&ANGLE);
STATE=3; M7[1].DISTANCE=700;ANGLE=90000;

 LOOP
 IF(ANGLE=>360000)ANGLE=0;END
  IF(KEY(_1))M7[1].CAMERA=CAM1;STATE=1;flip=true;FRAME;flip=false;END
  IF(KEY(_2))M7[1].CAMERA=CAM2;STATE=2;M7[1].DISTANCE=690;END
   SWITCH(STATE)
   CASE 1:
    X=480; Y=480; M7[1].HEIGHT=1700;M7[1].DISTANCE=48;
    ANGLE=90000;
    //M7.HEIGHT=314;
    IF(KEY(_C_MINUS))M7[1].DISTANCE-=10;END
    IF(KEY(_C_PLUS))M7[1].DISTANCE+=10;END
   END
   CASE 2:
    if(angle>180000 and angle<184000)flip=true;else flip=false;end
    X=480;Y=480;
    M7.HEIGHT=1700;
    IF(ANGLE<180000)M7[1].DISTANCE-=10;M7[1].HEIGHT-=40;ANGLE+=2000;END
    IF(angle>170000 and ANGLE<270000)M7[1].DISTANCE+=10;M7[1].HEIGHT+=40;ANGLE+=2000;END
    //if(angle==180000)if(cflags==0)cflags=1;else if(cflags==1)cflags=0;end end end
    IF(ANGLE==270000)IF(M7[1].DISTANCE<710)M7[1].DISTANCE+=10;END END
    //IF(M7[1].DISTANCE>710);M7[1].DISTANCE=700;END
   END
   CASE 3:
    //if(angle>180000 and angle<184000)flip=true;else flip=false;end
    X=480;Y=480;
    //M7.HEIGHT=1700;
    ANGLE+=2000;
    IF(ANGLE>00000 AND ANGLE<90000)  M7[1].HEIGHT+=35;M7[1].DISTANCE+=10;END
    IF(ANGLE>90000 AND ANGLE<180000) M7[1].HEIGHT-=35;M7[1].DISTANCE-=10;END
    IF(ANGLE>180000 AND ANGLE<270000)M7[1].HEIGHT+=35;M7[1].DISTANCE+=10;END
    IF(ANGLE>270000 AND ANGLE<360000)M7[1].HEIGHT-=35;M7[1].DISTANCE-=10;END

//    IF(ANGLE<180000)M7[1].DISTANCE-=10;M7[1].HEIGHT-=40;ANGLE+=2000;END
//    IF(angle>170000 and ANGLE<270000)M7[1].DISTANCE+=10;M7[1].HEIGHT+=40;ANGLE+=2000;END
    //if(angle==180000)if(cflags==0)cflags=1;else if(cflags==1)cflags=0;end end end
//    IF(ANGLE==270000)IF(M7[1].DISTANCE<710)M7[1].DISTANCE+=10;END END
    //IF(M7[1].DISTANCE>710);M7[1].DISTANCE=700;END
   END


   END

 FRAME;
 END
END
/////////////////////////////////////
PROCESS PLAYER1(GRAPH,X,Y);
PRIVATE MX=0;
BEGIN ctype=c_m7;ANGLE=90000;SIZE=200;FLAGS=0;
      SHADOW(X,Y,10,100);GRAPH=50;STATE=1;
LOOP
 SWITCH(STATE)
  CASE 1://IDLE
   GRAPH=ANIM1[A_STEP++];IF(A_STEP==SIZEOF(ANIM1));a_step=0;END
   IF(KEY(_LEFT)) GRAPH=79;STATE=2;END
   IF(KEY(_RIGHT))GRAPH=70;STATE=3;END
   IF(PLAY1HITTING==TRUE)
    IF(BALLX<X)GRAPH=90;STATE=4;ELSE IF(BALLX>X)GRAPH=90;STATE=42;END END
   END
  END
  CASE 2://WALK LEFT
   IF(MX<0)GRAPH--;IF(GRAPH<70)GRAPH=79;END END
   IF(KEY(_RIGHT))GRAPH=70;STATE=3;END
   IF(PLAY1HITTING==TRUE)
    IF(BALLX<X)GRAPH=90;STATE=4;ELSE IF(BALLX>X)GRAPH=90;STATE=42;END END
   END
   IF(MX==0)GRAPH=50;STATE=1;END
  END
  CASE 3://WALK RIGHT
   IF(MX>0)GRAPH++;IF(GRAPH>79)GRAPH=70;END END
   IF(KEY(_LEFT)) GRAPH=79;STATE=2;END
   IF(PLAY1HITTING==TRUE)
    IF(BALLX<X)GRAPH=90;STATE=4;ELSE IF(BALLX>X)GRAPH=90;STATE=42;END END
   END
   IF(MX==0)GRAPH=50;STATE=1;END
  END
  CASE 4://START FORWARD SWING
   FLAGS=0;
   IF(MX>0)MX-=2;END IF(MX<0)MX+=2;END
   IF(PLAY1HITTING==TRUE)
    IF(PLAYER1DIST>80 AND PLAYER1DIST<200)
     GRAPH++;IF(GRAPH>98)GRAPH=98;END
      ELSE IF(PLAYER1DIST<80)GRAPH=98;
            IF(BALLX<X)STATE=5;ELSE IF(BALLX>X)STATE=6;END END
      ELSE IF(PLAYER1DIST>200)GRAPH++;IF(GRAPH>108)PLAY1HITTING=FALSE;END END
     END
    END
   END
   IF(NOT KEY(_CONTROL))PLAY1HITTING=FALSE;END
   IF(PLAY1HITTING==FALSE)GRAPH=50;STATE=1;END
  END
  CASE 42://START BACKWARD SWING
  FLAGS=1;
   IF(MX>0)MX-=2;END IF(MX<0)MX+=2;END
   IF(PLAY1HITTING==TRUE)
    IF(PLAYER1DIST>80 AND PLAYER1DIST<200)
     GRAPH++;IF(GRAPH>98)GRAPH=98;END
      ELSE IF(PLAYER1DIST<80)GRAPH=98;
            IF(BALLX<X)STATE=5;ELSE IF(BALLX>X)STATE=6;END END
      ELSE IF(PLAYER1DIST>200)GRAPH++;IF(GRAPH>108)PLAY1HITTING=FALSE;END END
     END
    END
   END
   IF(NOT KEY(_CONTROL))PLAY1HITTING=FALSE;END
   IF(PLAY1HITTING==FALSE)GRAPH=50;STATE=1;END
  END
  CASE 5://FINISH FORWARD SWING
   IF (MX>0)MX-=2;END IF(MX<0)MX+=2;END
    GRAPH++;IF(GRAPH>108)PLAY1HITTING=FALSE;END
    IF(PLAY1HITTING==FALSE)GRAPH=50;STATE=1;END
  END//CASE 5;
  CASE 6://FINISH BACKWARD SWING
   IF (MX>0)MX-=2;END IF(MX<0)MX+=2;END
    GRAPH++;IF(GRAPH>108)PLAY1HITTING=FALSE;END
    IF(PLAY1HITTING==FALSE)GRAPH=50;STATE=1;END
  END//CASE 6;
 END//SWITCH

  SWITCH(NEWSCORE)
   CASE 1:
    SCORE=0;
   END
   CASE 2:
    SCORE=15;
   END
   CASE 3:
    SCORE=30;
   END
   CASE 4:
    SCORE=40;
   END
   CASE 5:
    SCORE=50;
   END
  END

IF(PLAY1HITTING==FALSE)
 IF(KEY(_UP))ADVANCE(5);END
 IF(KEY(_DOWN))ADVANCE(-4);END
 IF(KEY(_LEFT)) MX-=2;END
 IF(KEY(_RIGHT))MX+=2;END
END
 //  ELSE
IF(not key(_LEFT) AND not key(_RIGHT)) //STATE=5;//IDLE
 IF (MX>0)
  MX-=2;
 END
 IF (MX<0)
  MX+=2;
 END
END
IF(MX>16)MX=16;ELSE IF(MX<-16)MX=-16;END END
X+=MX;
//HITTING
IF(key(_CONTROL)OR KEY(_SPACE))PLAY1HITTING=TRUE;END
// IF(KEY(_LEFT))  END
// IF(KEY(_RIGHT)) END
// IF(KEY(_UP))    END
// IF(KEY(_DOWN))  END
//ELSE PLAY1HITTING=FALSE;END
//JUMPING
IF(KEY(_R_SHIFT))BSPEED+=60;JUMP=1;REPEAT frame;//jump
IF(KEY(_LEFT)) MX-=2;FLAGS=0;END
IF(KEY(_RIGHT))MX+=2;FLAGS=0;END
IF(KEY(_UP))ADVANCE(6);END
IF(KEY(_DOWN))ADVANCE(-5);END
IF(MX>20)MX=20;ELSE IF(MX<-20)MX=-20;END END X+=MX;
HEIGHT+=BSPEED;BSPEED-=5;UNTIL(HEIGHT<306)JUMP=0;ELSE HEIGHT=300;END
FRAME;
END
END
/////////////////////////////////////
/////////////////////////////////////
/////////////////////////////////////
/////////////////////////////////////
PROCESS PLAYER2(GRAPH,X,Y);
BEGIN ctype=c_m7;ANGLE=90000;SIZE=200;FLAGS=0;HEIGHT=300;SHADOW(X,Y,10,100);
//WRITE_INT(FNT1,200,500,4,&STATE);

LOOP
//SCORE SYSTEM//
SWITCH(NEWSCORE)CASE 1:SCORE=00;END CASE 2:SCORE=15;END
CASE 3:SCORE=30;END CASE 4:SCORE=40;END CASE 5:SCORE=50;END END
//CPU MOVEMENT//
IF(SERVING==TRUE)STATE=3;END
PLAYER2XDIST=X-BALLX;PLAYER2YDIST=Y-BALLY;
//
SWITCH(STATE)
CASE 1:
//IF(SWING==1)STATE=4;END IF(SWING==2)STATE=5;END
//IF(NOT MOVING)GRAPH=ANIM1b[A_STEP++];IF(A_STEP==SIZEOF(ANIM1b));a_step=0;END END
GRAPH=ANIM2b[A_STEP++];IF(A_STEP==SIZEOF(ANIM2b));a_step=0;END

IF(SERVING==TRUE)STATE=3;END
IF(X>490)X-=6;ELSE IF(X<480)X+=6;END END
IF(X>480 AND X<490)STATE=10;END
IF(BOUNCE==1)Y-=10;ELSE
IF(ID2==TRUE)Y-=10;ELSE
IF(ID1==TRUE)Y-=10;ELSE
IF(NETHIT>0)Y-=10;ELSE
IF(PLAY1HIT==TRUE)Y-=10;STATE=2;SWING=0;
END END END END END
END
//
CASE 2:

IF(PLAYER2DIST<200)STATE=4;END //IF(SWING==2)STATE=5;END

//IF(NOT MOVING)GRAPH=ANIM1b[A_STEP++];IF(A_STEP==SIZEOF(ANIM1b));a_step=0;END END
GRAPH=ANIM2b[A_STEP++];IF(A_STEP==SIZEOF(ANIM2b));a_step=0;END
IF(SERVING==TRUE)STATE=3;END

IF(PLAYER2XDIST>10 OR PLAYER2XDIST<-10)
 IF(BALLX>X)X+=14;ELSE
 IF(BALLX<X)X-=14;END END
ELSE //MOVING=FALSE;
 IF(BALLX>X)X+=6;ELSE
 IF(BALLX<X)X-=6;END END
END
IF(BALLDIR>10 AND BALLDIR<14)
 IF(Y<300)
  IF(PLAYER2YDIST>10 OR PLAYER2YDIST<-10)
   IF(BALLY>Y)Y+=10;ELSE
   IF(BALLY<Y)Y-=10;END END
  ELSE //MOVING=FALSE;
   IF(BALLY>Y)Y+=4;ELSE
   IF(BALLY<Y)Y-=4;END END
  END
  END
ELSE
IF(BOUNCE==1)Y-=10;ELSE
IF(ID2==TRUE)Y-=10;ELSE
IF(ID1==TRUE)Y-=10;ELSE
IF(NETHIT>0)Y-=10;ELSE
IF(PLAY1HIT==TRUE)Y-=10;
END END END END END

END
END//CASE2
/////////////
CASE 3:
 X=720;
 GRAPH=ANIM2b[A_STEP++];IF(A_STEP==SIZEOF(ANIM2b));a_step=0;SWING=0;END
 IF(BALLVAL.STATE<>11)STATE=32;END
END
/////////////
CASE 32;
 GRAPH=ANIM4b[A_STEP++];IF(A_STEP==SIZEOF(ANIM4b));a_step=0;SWING=0;STATE=33;END
END
/////////////
CASE 33:
 IF(SERVING==FALSE)GRAPH=80;A_STEP=0;STATE=1;END
END
/////////////
CASE 4:
 GRAPH=ANIM4b[A_STEP++];IF(A_STEP==SIZEOF(ANIM4b));a_step=0;GRAPH=60;STATE=1;SWING=0;END
//
IF(PLAYER2XDIST>10 OR PLAYER2XDIST<-10) //MOVING=TRUE;
 IF(BALLX>X)X+=10;ELSE
 IF(BALLX<X)X-=10;END END
ELSE //MOVING=FALSE;
 IF(BALLX>X)X+=4;ELSE
 IF(BALLX<X)X-=4;END END
END
IF(BALLDIR>10 AND BALLDIR<14)
 IF(Y<300)
  IF(PLAYER2YDIST>10 OR PLAYER2YDIST<-10) //MOVING=TRUE;
   IF(BALLY>Y)Y+=10;ELSE
   IF(BALLY<Y)Y-=10;END END
  ELSE //MOVING=FALSE;
   IF(BALLY>Y)Y+=4;ELSE
   IF(BALLY<Y)Y-=4;END END
  END
  END
ELSE
IF(BOUNCE==1)Y-=10;ELSE
IF(ID2==TRUE)Y-=10;ELSE
IF(ID1==TRUE)Y-=10;ELSE
IF(NETHIT>0)Y-=10;ELSE
IF(PLAY1HIT==TRUE)Y-=10;
END END END END END
END
//
END
CASE 5:
 GRAPH=ANIM4b[A_STEP++];IF(A_STEP==SIZEOF(ANIM4b));a_step=0;GRAPH=60;STATE=1;SWING=0;END
END

CASE 10:
GRAPH=ANIM1b[A_STEP++];IF(A_STEP==SIZEOF(ANIM1b));a_step=0;END
IF(PLAY1HIT==TRUE)STATE=2;SWING=0;END
END

END//SWITCH
//////////////////////
//IF(SERVING==TRUE)X=720;END
IF(Y<65)Y=65;END
FRAME();
END
END
/////////////////////////////////
PROCESS BALL(X,Y,IX,IY,HEIGHT);
BEGIN
ctype=c_m7;
GRAPH=2; SIZE=400; HEIGHT=0;
SHADOW(X,Y,3,250);
NEWBALL=0;KINGSIGNAL=0;
BSPEED=45;
SERVING=TRUE;IY=14;IX=-8;BALLDIR=14;
BOUNCE=0;ID1=FALSE;
STATE=10;
ENERGY=0;
Z=-100000;
//WRITE_INT(FNT1,100,600,3,&PLAYER2DIST);WRITE_INT(0,100,650,3,&SERVING);
//WRITE_INT(FNT1,200,600,3,&STATE);
//REPEAT
FRAME(3000);
LOOP  NVAL=Y/2;
SWITCH(STATE)
CASE 1:

////////////////////////////////////PLAYER2s AI////////////////////
PLAYER2DIST=GET_DIST(PLAY2);
IF(PLAYER2DIST>60)SERVING=FALSE;end
//IF(HEIGHT=<PLAY2.HEIGHT+200)  //MAKE SURE BALL IS NOT ABOVE PLAYER//
//IF(HEIGHT>PLAY2.HEIGHT)       //MAKE SURE BALL IS NOT BELOW PLAYER//
IF(SERVING==TRUE)IY=16;IX=-8;BALLDIR=14;ELSE
IF(SERVING==FALSE)
 IF(PLAYER2XDIST<30 AND PLAYER2XDIST>-30 AND PLAYER2YDIST<30 AND PLAYER2YDIST>-30)
  PLAY2HIT=TRUE;PLAY1HIT=FALSE;BSPEED=40;BOUNCE=0;
//IF(HEIGHT=<PLAY1.HEIGHT+150) //+250 //MAKE SURE BALL IS NOT ABOVE PLAYER//
//IF(HEIGHT=>PLAY1.HEIGHT-300)//0     //MAKE SURE BALL IS NOT BELOW PLAYER//

  IF(Y=>PLAY2.Y)
   IF(X<371)
    IF(RAND(0,13)==12)IY=16;IX=0;BALLDIR=14;SWING=1;ELSE
    IF(RAND(0,13)==13)IY=16;IX=8;BALLDIR=14;SWING=2;ELSE
    IF(RAND(0,13)<7) IY=6;IX=2; BALLDIR=1;SWING=1;ELSE
    IF(RAND(0,13)=>7 AND RAND(0,13)<10) IY=6;IX=0; BALLDIR=1;SWING=1;ELSE
    IF(RAND(0,13)==10) IY=6;IX=-1; BALLDIR=1;SWING=2;
    END END END END END
   END
   IF(X>599)
    IF(RAND(0,13)==12)IY=16;IX=0;BALLDIR=14;SWING=1;ELSE
    IF(RAND(0,13)==13)IY=16;IX=-8;BALLDIR=14;SWING=2;ELSE
    IF(RAND(0,10)<7) IY=6;IX=-2;BALLDIR=1;SWING=2;ELSE
    IF(RAND(0,10)=>7 AND RAND(0,13)<10) IY=6;IX=0;BALLDIR=1;SWING=2;ELSE
    IF(RAND(0,10)==10) IY=6;IX=1; BALLDIR=1;SWING=1;
    END END END END END
   END
   IF(X>370 AND X<600)
    IF(RAND(0,13)==13)IY=5;IX=0;BALLDIR=11;SWING=1;ELSE
    IF(RAND(0,13)==10)IY=16;IX=0;BALLDIR=14;SWING=1;ELSE
    IF(RAND(0,13)==11)IY=16;IX=8;BALLDIR=14;SWING=1;ELSE
    IF(RAND(0,13)==12)IY=16;IX=-8;BALLDIR=14;SWING=2;ELSE
    IF(RAND(0,13)=>0 AND RAND(0,13)<3) IY=6;IX=-3;BALLDIR=1;SWING=2;ELSE
    IF(RAND(0,13)=>3 AND RAND(0,13)<6) IY=6;IX=3; BALLDIR=1;SWING=1;ELSE
    IF(RAND(0,13)=>6 AND RAND(0,13)<9) IY=6;IX=0; BALLDIR=1;SWING=1;
    END END END END END END END
   END
   //IF(X>480 AND X<490)
    //IF(RAND(0,2)==2)IY=16;IX=0;BALLDIR=14;SWING=1;END
   END
  END
 END
END// END
//END END
///////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////
//////////////////////////////PLAYER1s BALL CONTROLL///////////////
PLAYER1DIST=GET_DIST(PLAY1);
IF(HEIGHT=<PLAY1.HEIGHT+150) //+250 //MAKE SURE BALL IS NOT ABOVE PLAYER//
IF(HEIGHT=>PLAY1.HEIGHT-300)//0     //MAKE SURE BALL IS NOT BELOW PLAYER//
IF(Y=<PLAY1.Y)                      //AND BALL IS INFRONT OF PLAYER//
IF(PLAYER1DIST<70 AND PLAY1HITTING==TRUE)
PLAY1HIT=TRUE;PLAY2HIT=FALSE;BSPEED=40;BOUNCE=0;ENERGY++;


if(energy>6)
IF (KEY(_UP))    IY=-16;IX=0;BALLDIR=14;else
IF (KEY(_LEFT))  IY=-16;IX=-8;BALLDIR=14;else
IF (KEY(_RIGHT)) IY=-16;IX=8; BALLDIR=14;else
iy=-12;ix=0;BALLDIR=14;end end end
end

if(energy=<6 and PLAYER1DIST<70)
IF (PLAY1HITTING==TRUE)IY=-6;IX=0; BALLDIR=1;BOUNCE=0;END
 IF(PLAY1.X<483)
  IF (KEY(_LEFT))  IY=-6;IX=-3;BALLDIR=1;End
  IF (KEY(_RIGHT)) IY=-6;IX=4; BALLDIR=1;End
  IF (KEY(_UP))    IY=-6;IX=0;BALLDIR=1;end
 ELSE
 IF(PLAY1.X>482)
  IF (KEY(_LEFT))  IY=-6;IX=-4;BALLDIR=1;End
  IF (KEY(_RIGHT)) IY=-6;IX=3; BALLDIR=1;End
  IF (KEY(_UP))    IY=-6;IX=0;BALLDIR=1;end
 END
 END
IF (KEY(_DOWN))  IY=-4;IX=0; BALLDIR=11;
 IF (KEY(_LEFT)) IY=-4;IX=-4;end
 IF (KEY(_RIGHT))IY=-4;IX=4; end
end
//iy=-6;end //

end

END END END END
///////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////
//BALL BOUNCES//////////////
SWITCH(BALLDIR)
 CASE 1:
  HEIGHT+=BSPEED;BSPEED-=1;IF(HEIGHT<10) BALLDIR++;BOUNCE++;END
 END
 CASE 2:
  BSPEED=30;BALLDIR++; IY-=2; MARKER(X,Y);
 END
 CASE 3:
  HEIGHT+=BSPEED;BSPEED-=1;IF(HEIGHT<10) BALLDIR++;BOUNCE++;END
 END
 CASE 4:
  BSPEED=20;BALLDIR++; IY-=2; MARKER(X,Y);
 END
 CASE 5:
  HEIGHT+=BSPEED;BSPEED-=1;IF(HEIGHT<10) BALLDIR++;BOUNCE++;END
 END
 CASE 6:
  BSPEED=15;BALLDIR++; IY--;  MARKER(X,Y);
 END
 CASE 7:
  HEIGHT+=BSPEED;BSPEED-=1;IF(HEIGHT<10) BALLDIR++;BOUNCE++;END
 END
 CASE 8:
  BSPEED=10;BALLDIR++;        MARKER(X,Y);
 END
 CASE 9:
  HEIGHT+=BSPEED;BSPEED-=1;IF(HEIGHT<10) BALLDIR++;BOUNCE++;END
 END
 CASE 10:
  HEIGHT=0;
 END

 CASE 11:
  HEIGHT+=BSPEED;BSPEED-=1;IF(HEIGHT<10) BALLDIR++;BOUNCE++;END
 END
 CASE 12:
  BSPEED=30;BALLDIR++; IY-=1; MARKER(X,Y);
 END
 CASE 13:
  HEIGHT+=BSPEED;BSPEED-=1;IF(HEIGHT<10) BALLDIR++;BOUNCE++;END
 END

 CASE 14:
  HEIGHT+=BSPEED;BSPEED-=3;IF(HEIGHT<10) BALLDIR++;BOUNCE++;END
 END
 CASE 15:
  BSPEED=30;BALLDIR++; IY-=2; MARKER(X,Y);
 END
 CASE 16:
  HEIGHT+=BSPEED;BSPEED-=1;IF(HEIGHT<10) BALLDIR++;BOUNCE++;END
 END


END

//IF(HEIGHT<0)MARKER(X,Y); END
//IF(HEIGHT>CREST*2)BALLDIR=2;END

//
IF(HEIGHT<0)HEIGHT=0;END
//NET COLLISION////////////////
IF(Y=>475 AND Y=<489)//NEAR NET
 IF(HEIGHT=<400 AND ID1==0 AND ID2==0)IY=-IY;IX=-IX;NETHIT+=1;END
 //IF(KEY(_LEFT))IX=-4;ELSE IF(KEY(_RIGHT))IX=4;END END//AFTERTOUCH
END
///////////////////////////////
BALLY=y=Y+IY; BALLX=x=X+IX;
/////////////////////
//BOUNDARIES OF COURT//
IF(ID2=(X>932 AND HEIGHT<12))     //                   //
ELSE                              //       OUT!        //
IF(ID2=(X<33 AND HEIGHT<12))
ELSE
IF(ID2=(Y>897 AND HEIGHT<12))
ELSE
IF(ID2=(Y<59 AND HEIGHT<12))
END END  //FOR THE COURT
END END  //BOUNDARIES
////////////////////////////////
////////////////////////////////
IF(BOUNCE>1)ID1=TRUE;
 IF(Y>482)
  PLAY2.NEWSCORE++; KINGSIGNAL=1;
 ELSE
  PLAY1.NEWSCORE++; KINGSIGNAL=2;
 END
END
//
IF(ID1)STATE=2;END
IF(ID2 AND BOUNCE==1)STATE=3;END
IF(ID2 AND ID1==0)STATE=4;END
IF(NETHIT>0)STATE=5;END

END//CASE
////////////////////////////////
CASE 10:
 BSPEED=60;SERVING=TRUE;STATE=11;
END
////////////////////////////////
CASE 11:
 HEIGHT+=BSPEED;BSPEED-=1;IF(BSPEED<-50)
 STATE=12;BSPEED=45;
 END
END
////////////////////////////////
CASE 12:
 HEIGHT+=BSPEED;BSPEED-=1;
 IY=14;IX=-8;BALLDIR=14;BOUNCE=0;//ID1=FALSE;
 //IF(PLAYER2DIST>100)SERVING=FALSE;END
 //FRAME(2000);
 STATE=1;//SERVING=FALSE;
END
////////////////////////////////
CASE 2:
IF(ID1)  TIMER[2]=0;
REPEAT FRAME(100); Y=Y+IY; X=X+IX;
UNTIL(TIMER[2]>300);
SIGNAL(TYPE BALL,S_KILL_TREE);NEWBALL=1;
END
END
////////////////////////////////
////////////////////////////////
CASE 3:
IF(ID2 AND BOUNCE==1)TIMER[2]=0;
 IF(Y>482)
  PLAY2.NEWSCORE++; KINGSIGNAL=1;
 ELSE
  PLAY1.NEWSCORE++; KINGSIGNAL=2;
 END
REPEAT FRAME(100); Y=Y+IY; X=X+IX;
UNTIL(TIMER[2]>300);
SIGNAL(TYPE BALL,S_KILL_TREE);NEWBALL=1;
END

END
////////////////////////////////
////////////////////////////////
CASE 4:
IF(ID2 AND ID1==0) TIMER[2]=0;BOUNCE=0;
 IF(PLAY2HIT==TRUE)
  PLAY1.NEWSCORE++; KINGSIGNAL=1;
 ELSE
  PLAY2.NEWSCORE++; KINGSIGNAL=2;
 END
OUTEXT=WRITE(FNT2,512,384,4,"OUT!");
REPEAT FRAME(100); Y=Y+IY; X=X+IX;
MOVE_TEXT(OUTEXT,RAND(500,520),384);
UNTIL(TIMER[2]>300);
SIGNAL(TYPE BALL,S_KILL_TREE);DELETE_TEXT(OUTEXT);NEWBALL=1;
END

END
////////////////////////////////
////////////////////////////////
CASE 5:
IF(NETHIT>0)     TIMER[2]=0;
 IF(Y>482)
  PLAY2.NEWSCORE++; KINGSIGNAL=1;
 ELSE
  PLAY1.NEWSCORE++; KINGSIGNAL=2;
 END
OUTEXT=WRITE(FNT2,512,384,4,"NET!");
REPEAT FRAME(100);X=X+IX;IF(HEIGHT>0)HEIGHT-=10;END
MOVE_TEXT(OUTEXT,RAND(500,520),384);
UNTIL(TIMER[2]>300);
SIGNAL(TYPE BALL,S_KILL_TREE);DELETE_TEXT(OUTEXT);NEWBALL=1;NETHIT=0;
END

END//CASE 5
END//SWITCH
//UNTIL (Y<-5000) SIGNAL(TYPE BALL,S_KILL_TREE); NEWBALL=1;
FRAME(50);
END
END
////////////////////////////////////////
PROCESS MARKER(X,Y);
PRIVATE MTIME=0;
BEGIN CTYPE=C_M7;GRAPH=8;FLAGS=4;SIZE=300;//MTIME=0;
REPEAT FRAME; MTIME++;
UNTIL(MTIME>50)SIGNAL(ID,S_KILL);
END
/////////////////////////////////

/////////////////////////////////
PROCESS SHADOW(X,Y,GRAPH,SIZE2);
PRIVATE //SIZE2=100;
BEGIN Ctype=c_m7;flags=4;z=100;HEIGHT=0;
LOOP x=FATHER.x;y=FATHER.y;SIZE=SIZE2-((FATHER.HEIGHT/5)-200); FRAME;END
END
/////////////////////////////////////













































































































































































